<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="Electron" modified="2024-01-20T09:00:00.000Z" agent="5.0" version="21.1.2" etag="def456" type="device">
  <diagram id="ai-bill-export-architecture" name="AIè´¦å•å¯¼å‡ºåŠŸèƒ½æž¶æž„">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- æ ‡é¢˜ -->
        <mxCell id="title" value="AIè´¦å•å¯¼å‡ºåŠŸèƒ½æž¶æž„å›¾" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="300" height="30" as="geometry" />
        </mxCell>
        
        <!-- å‰ç«¯UIå±‚ -->
        <mxCell id="frontend-layer" value="ðŸ“± å‰ç«¯UIå±‚" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="1000" height="40" as="geometry" />
        </mxCell>
        
        <!-- Reactç»„ä»¶ -->
        <mxCell id="react-component" value="AIBillExport.tsx&lt;br/&gt;&lt;br/&gt;â€¢ æŸ¥è¯¢è¡¨å• (å…¬å¸ã€ç§Ÿæˆ·ã€æ—¶é—´èŒƒå›´ç­‰)&lt;br/&gt;â€¢ æ•°æ®è¡¨æ ¼ (ä¸ŽAPIè¿”å›žæ ¼å¼å®Œå…¨ä¸€è‡´)&lt;br/&gt;â€¢ å¯¼å‡ºæŒ‰é’®&lt;br/&gt;â€¢ åˆ†é¡µæŽ§åˆ¶" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="140" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- è¡¨æ ¼åˆ—é…ç½® -->
        <mxCell id="table-columns" value="è¡¨æ ¼åˆ—é…ç½®&lt;br/&gt;&lt;br/&gt;â€¢ IDã€å®¢æˆ·åç§°ã€ç§Ÿæˆ·åç§°&lt;br/&gt;â€¢ AIæµç¨‹åç§°ã€å‘¼å«æ–¹å‘&lt;br/&gt;â€¢ ä¸»å«/è¢«å«å·ç ã€é€šè¯æ—¶é•¿&lt;br/&gt;â€¢ å„ç§æˆæœ¬å’Œåˆ©æ¶¦å­—æ®µ&lt;br/&gt;â€¢ æ—¶é—´æ ¼å¼åŒ–ã€è´§å¸æ ¼å¼åŒ–" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="400" y="140" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- ç”¨æˆ·äº¤äº’ -->
        <mxCell id="user-interaction" value="ç”¨æˆ·äº¤äº’é€»è¾‘&lt;br/&gt;&lt;br/&gt;â€¢ å…¬å¸é€‰æ‹© â†’ è‡ªåŠ¨åŠ è½½ç§Ÿæˆ·&lt;br/&gt;â€¢ æŸ¥è¯¢æ¡ä»¶è”åŠ¨&lt;br/&gt;â€¢ å®žæ—¶æœç´¢å’Œç­›é€‰&lt;br/&gt;â€¢ ä¸€é”®å¯¼å‡ºExcel&lt;br/&gt;â€¢ é”™è¯¯æç¤ºå’ŒåŠ è½½çŠ¶æ€" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="720" y="140" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- APIæœåŠ¡å±‚ -->
        <mxCell id="api-layer" value="ðŸ”Œ APIæœåŠ¡å±‚" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="300" width="1000" height="40" as="geometry" />
        </mxCell>
        
        <!-- AIè´¦å•API -->
        <mxCell id="ai-bill-api" value="aiBillApi.ts&lt;br/&gt;&lt;br/&gt;â€¢ queryAIBill() - æŸ¥è¯¢AIè´¦å•&lt;br/&gt;â€¢ queryCompanyByName() - æŸ¥è¯¢å…¬å¸&lt;br/&gt;â€¢ queryTenantByCompanyId() - æŸ¥è¯¢ç§Ÿæˆ·&lt;br/&gt;â€¢ exportAIBillData() - å¯¼å‡ºæ•°æ®&lt;br/&gt;â€¢ ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œè®¤è¯" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="360" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- è¯·æ±‚é…ç½® -->
        <mxCell id="request-config" value="è¯·æ±‚é…ç½®&lt;br/&gt;&lt;br/&gt;â€¢ axioså®žä¾‹é…ç½®&lt;br/&gt;â€¢ è¯·æ±‚/å“åº”æ‹¦æˆªå™¨&lt;br/&gt;â€¢ è®¤è¯å¤´è‡ªåŠ¨æ·»åŠ &lt;br/&gt;â€¢ system_id: 4 (è´¦å•API)&lt;br/&gt;â€¢ é”™è¯¯ç»Ÿä¸€å¤„ç†" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="400" y="360" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- æ•°æ®æ ¼å¼åŒ– -->
        <mxCell id="data-formatting" value="æ•°æ®æ ¼å¼åŒ–&lt;br/&gt;&lt;br/&gt;â€¢ TypeScriptç±»åž‹å®šä¹‰&lt;br/&gt;â€¢ APIå“åº”æ•°æ®æ˜ å°„&lt;br/&gt;â€¢ åˆ†é¡µå‚æ•°å¤„ç†&lt;br/&gt;â€¢ æŸ¥è¯¢æ¡ä»¶æž„å»º&lt;br/&gt;â€¢ å“åº”æ•°æ®æ ¡éªŒ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="720" y="360" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- Excelå¯¼å‡ºå±‚ -->
        <mxCell id="excel-layer" value="ðŸ“Š Excelå¯¼å‡ºå±‚" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="520" width="1000" height="40" as="geometry" />
        </mxCell>
        
        <!-- Excelå·¥å…· -->
        <mxCell id="excel-utils" value="excelExport.ts&lt;br/&gt;&lt;br/&gt;â€¢ exportAIBillToExcel() - å•æ¬¡å¯¼å‡º&lt;br/&gt;â€¢ exportAIBillBatch() - æ‰¹é‡å¯¼å‡º&lt;br/&gt;â€¢ exportAIBillByQuery() - æ¡ä»¶å¯¼å‡º&lt;br/&gt;â€¢ å¤§æ•°æ®é‡åˆ†é¡µå¤„ç†&lt;br/&gt;â€¢ è¿›åº¦æç¤ºå’Œé”™è¯¯å¤„ç†" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="580" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- åˆ—é…ç½® -->
        <mxCell id="column-config" value="åˆ—é…ç½®ç®¡ç†&lt;br/&gt;&lt;br/&gt;â€¢ AI_BILL_COLUMNS é…ç½®&lt;br/&gt;â€¢ 22ä¸ªå­—æ®µå®Œæ•´æ˜ å°„&lt;br/&gt;â€¢ è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨&lt;br/&gt;â€¢ åˆ—å®½è‡ªé€‚åº”&lt;br/&gt;â€¢ æ ·å¼å’ŒæŽ’ç‰ˆä¼˜åŒ–" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="400" y="580" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- XLSXå¤„ç† -->
        <mxCell id="xlsx-processing" value="XLSXå¤„ç†&lt;br/&gt;&lt;br/&gt;â€¢ æ•°æ®è½¬æ¢ (aoa_to_sheet)&lt;br/&gt;â€¢ æ ·å¼è®¾ç½® (è¡¨å¤´åŠ ç²—)&lt;br/&gt;â€¢ æ–‡ä»¶ç”Ÿæˆå’Œä¸‹è½½&lt;br/&gt;â€¢ æ—¶é—´æˆ³æ–‡ä»¶å&lt;br/&gt;â€¢ æµè§ˆå™¨å…¼å®¹æ€§" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="720" y="580" width="280" height="120" as="geometry" />
        </mxCell>
        
        <!-- åŽç«¯APIç«¯ç‚¹ -->
        <mxCell id="backend-layer" value="ðŸ–¥ï¸ åŽç«¯APIç«¯ç‚¹" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#ff0000;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="740" width="1000" height="40" as="geometry" />
        </mxCell>
        
        <!-- APIç«¯ç‚¹è¯¦æƒ… -->
        <mxCell id="api-endpoints" value="APIç«¯ç‚¹&lt;br/&gt;&lt;br/&gt;â€¢ /nxBill/usage/aiAgentCdr/query&lt;br/&gt;â€¢ /admin/saas_plat_manager/company/queryLikeByCompanyName&lt;br/&gt;â€¢ /admin/saas_plat_manager/company/queryTenantByCompanyId&lt;br/&gt;â€¢ æ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æŽ’åº&lt;br/&gt;â€¢ è¿”å›žæ ‡å‡†JSONæ ¼å¼" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="200" y="800" width="600" height="120" as="geometry" />
        </mxCell>
        
        <!-- æ•°æ®æµç®­å¤´ -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#4472C4;" edge="1" parent="1" source="react-component" target="ai-bill-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-label" value="APIè°ƒç”¨" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow1">
          <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#70AD47;" edge="1" parent="1" source="table-columns" target="excel-utils">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-label" value="Excelå¯¼å‡º" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow2">
          <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#FF6B35;" edge="1" parent="1" source="ai-bill-api" target="api-endpoints">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-label" value="HTTPè¯·æ±‚" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow3">
          <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- ç‰¹æ€§è¯´æ˜Ž -->
        <mxCell id="features" value="ðŸŽ¯ æ ¸å¿ƒç‰¹æ€§&lt;br/&gt;&lt;br/&gt;âœ… å®Œå…¨ä¸€è‡´: Excelåˆ—å’Œæ•°æ®ä¸Žè¡¨æ ¼å®Œå…¨å¯¹åº”&lt;br/&gt;âœ… å¤§æ•°æ®é‡: æ”¯æŒåˆ†é¡µæ‰¹é‡å¯¼å‡º&lt;br/&gt;âœ… æ™ºèƒ½ç­›é€‰: å…¬å¸â†’ç§Ÿæˆ·çº§è”é€‰æ‹©&lt;br/&gt;âœ… æ ¼å¼ä¼˜åŒ–: æ—¶é—´ã€è´§å¸ã€çŠ¶æ€æ ¼å¼åŒ–&lt;br/&gt;âœ… é”™è¯¯å¤„ç†: å®Œå–„çš„å¼‚å¸¸æ•èŽ·å’Œç”¨æˆ·æç¤º&lt;br/&gt;âœ… æ–‡ä»¶å‘½å: åŒ…å«å…¬å¸åå’Œæ—¶é—´æˆ³" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4edda;strokeColor=#155724;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="850" y="800" width="300" height="160" as="geometry" />
        </mxCell>
        
        <!-- nginxä¿®å¤è¯´æ˜Ž -->
        <mxCell id="nginx-fix" value="ðŸ”§ Nginxé…ç½®ä¿®å¤&lt;br/&gt;&lt;br/&gt;â€¢ underscores_in_headers on&lt;br/&gt;â€¢ æ­£ç¡®è½¬å‘system_idç­‰è¯·æ±‚å¤´&lt;br/&gt;â€¢ è§£å†³äº†NPEé—®é¢˜&lt;br/&gt;â€¢ APIè°ƒç”¨çŽ°åœ¨ç¨³å®šå¯é " style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#004080;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="800" width="120" height="120" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile> 