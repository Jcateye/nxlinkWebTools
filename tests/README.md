# æµ‹è¯•è„šæœ¬è¯´æ˜

æœ¬ç›®å½•åŒ…å«é¡¹ç›®çš„å„ç§æµ‹è¯•è„šæœ¬ï¼ŒæŒ‰ç…§åŠŸèƒ½åˆ†ç±»ç»„ç»‡ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ api/                    # APIåŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test-simple-mapping.js     # ç®€åŒ–å­—æ®µæ˜ å°„æµ‹è¯•
â”‚   â”œâ”€â”€ test-new-webhook.js        # æ–°Webhookæ¥å£æµ‹è¯•
â”‚   â”œâ”€â”€ test-template-config.js    # æ¨¡æ¿é…ç½®æµ‹è¯•
â”‚   â”œâ”€â”€ test-api-key-deletion.js   # API Keyåˆ é™¤æµ‹è¯•
â”‚   â”œâ”€â”€ test-api-key-desensitization.js # API Keyè„±æ•æµ‹è¯•
â”‚   â”œâ”€â”€ test-api-key-management.js # API Keyç®¡ç†æµ‹è¯•
â”‚   â”œâ”€â”€ test-form-mapping.js       # è¡¨å•æ˜ å°„æµ‹è¯•
â”‚   â”œâ”€â”€ test-form-webhook.js       # è¡¨å•Webhookæµ‹è¯•
â”‚   â””â”€â”€ test-multi-tenant.js       # å¤šç§Ÿæˆ·æµ‹è¯•
â”œâ”€â”€ config/                # é…ç½®ç›¸å…³æµ‹è¯•ï¼ˆæš‚æ— ï¼‰
â”œâ”€â”€ docker/                # Dockeréƒ¨ç½²æµ‹è¯•
â”‚   â”œâ”€â”€ test-docker-build.sh       # Dockeræ„å»ºæµ‹è¯•
â”‚   â”œâ”€â”€ test-docker-deploy.sh      # Dockeréƒ¨ç½²æµ‹è¯•
â”‚   â””â”€â”€ test-docker-quick.sh       # Dockerå¿«é€Ÿæµ‹è¯•
â””â”€â”€ integration/           # é›†æˆæµ‹è¯•
    â”œâ”€â”€ test-env-loading.sh        # ç¯å¢ƒåŠ è½½æµ‹è¯•
    â””â”€â”€ test-production-start.sh   # ç”Ÿäº§ç¯å¢ƒå¯åŠ¨æµ‹è¯•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰APIæµ‹è¯•
```bash
# æµ‹è¯•ç®€åŒ–å­—æ®µæ˜ å°„
node tests/api/test-simple-mapping.js

# æµ‹è¯•æ–°çš„Webhookæ¥å£
node tests/api/test-new-webhook.js

# æµ‹è¯•æ¨¡æ¿é…ç½®
node tests/api/test-template-config.js
```

### è¿è¡ŒDockeræµ‹è¯•
```bash
# Dockeræ„å»ºæµ‹è¯•
bash tests/docker/test-docker-build.sh

# Dockeréƒ¨ç½²æµ‹è¯•
bash tests/docker/test-docker-deploy.sh
```

## ğŸ“‹ æµ‹è¯•è„šæœ¬è¯´æ˜

### APIæµ‹è¯•

#### `test-simple-mapping.js`
æµ‹è¯•ç®€åŒ–çš„å­—æ®µæ˜ å°„åŠŸèƒ½ï¼š
- `phone` â†’ `phoneNumber` (ç›´æ¥æ˜ å°„)
- `name` â†’ `name` (ç›´æ¥æ˜ å°„)
- å…¶ä»–å­—æ®µ â†’ `params["å­—æ®µkey"]` (ç›´æ¥ä½¿ç”¨å­—æ®µkey)

#### `test-new-webhook.js`
æµ‹è¯•æ–°çš„Webhookæ¥å£åŠŸèƒ½ï¼š
- URLå‚æ•°ä¼ é€’taskIdå’ŒtemplateId
- æ¨¡æ¿ç³»ç»ŸéªŒè¯
- æ•°æ®å¤„ç†é€»è¾‘

#### `test-template-config.js`
æµ‹è¯•æ¨¡æ¿é…ç½®ç³»ç»Ÿï¼š
- æ¨¡æ¿åŠ è½½å’ŒéªŒè¯
- å­—æ®µæ˜ å°„é…ç½®
- æ¨¡æ¿å‚æ•°å¤„ç†

#### `test-api-key-*.js`
API Keyç›¸å…³åŠŸèƒ½æµ‹è¯•ï¼š
- åˆ é™¤ã€è„±æ•ã€ç®¡ç†ç­‰åŠŸèƒ½éªŒè¯

#### `test-form-*.js`
è¡¨å•ç›¸å…³åŠŸèƒ½æµ‹è¯•ï¼š
- è¡¨å•æ˜ å°„ã€Webhookå¤„ç†ç­‰

#### `test-multi-tenant.js`
å¤šç§Ÿæˆ·åŠŸèƒ½æµ‹è¯•

### Dockeræµ‹è¯•

#### `test-docker-build.sh`
æµ‹è¯•Dockeré•œåƒæ„å»ºè¿‡ç¨‹

#### `test-docker-deploy.sh`
æµ‹è¯•Dockerå®¹å™¨éƒ¨ç½²

#### `test-docker-quick.sh`
å¿«é€ŸDockeræµ‹è¯•è„šæœ¬

### é›†æˆæµ‹è¯•

#### `test-env-loading.sh`
æµ‹è¯•ç¯å¢ƒå˜é‡åŠ è½½

#### `test-production-start.sh`
æµ‹è¯•ç”Ÿäº§ç¯å¢ƒå¯åŠ¨

## ğŸ”§ é…ç½®è¯´æ˜

### æµ‹è¯•ç¯å¢ƒè®¾ç½®

åœ¨è¿è¡Œæµ‹è¯•å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. **å¯åŠ¨æœåŠ¡**
   ```bash
   npm run dev  # å¼€å‘ç¯å¢ƒ
   # æˆ–
   npm start    # ç”Ÿäº§ç¯å¢ƒ
   ```

2. **é…ç½®æµ‹è¯•å‚æ•°**
   ä¿®æ”¹æµ‹è¯•è„šæœ¬ä¸­çš„é…ç½®ï¼š
   ```javascript
   const TEST_CONFIG = {
     baseUrl: 'http://localhost:8400',  // æœåŠ¡åœ°å€
     taskId: 'your-task-id',            // å®é™…çš„ä»»åŠ¡ID
     apiKey: 'your-api-key'             // å®é™…çš„API Key
   };
   ```

3. **å‡†å¤‡æµ‹è¯•æ•°æ®**
   æ ¹æ®æµ‹è¯•è„šæœ¬çš„è¦æ±‚å‡†å¤‡ç›¸åº”çš„æµ‹è¯•æ•°æ®

## ğŸ“Š æµ‹è¯•ç»“æœè¯´æ˜

### æˆåŠŸæ ‡è¯†
- âœ… æµ‹è¯•é€šè¿‡
- ğŸ“Š æ˜¾ç¤ºç›¸å…³ç»Ÿè®¡ä¿¡æ¯
- ğŸ¯ éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§

### å¤±è´¥æ ‡è¯†
- âŒ æµ‹è¯•å¤±è´¥
- ğŸ’¥ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- ğŸ” æä¾›è°ƒè¯•ä¿¡æ¯

## ğŸ› ï¸ è‡ªå®šä¹‰æµ‹è¯•

### æ·»åŠ æ–°çš„APIæµ‹è¯•
1. åœ¨ `tests/api/` ç›®å½•åˆ›å»ºæ–°çš„æµ‹è¯•è„šæœ¬
2. éµå¾ªç°æœ‰çš„å‘½åè§„èŒƒï¼š`test-åŠŸèƒ½åç§°.js`
3. å‚è€ƒç°æœ‰æµ‹è¯•è„šæœ¬çš„ç»“æ„

### æ·»åŠ æ–°çš„Dockeræµ‹è¯•
1. åœ¨ `tests/docker/` ç›®å½•åˆ›å»ºæ–°çš„æµ‹è¯•è„šæœ¬
2. ä½¿ç”¨ `.sh` æ‰©å±•å
3. éµå¾ªç°æœ‰çš„å‘½åè§„èŒƒ

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒè¦æ±‚**ï¼šç¡®ä¿æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´
2. **æ•°æ®å®‰å…¨**ï¼šæµ‹è¯•æ•°æ®ä¸è¦åŒ…å«æ•æ„Ÿä¿¡æ¯
3. **æ¸…ç†å·¥ä½œ**ï¼šæµ‹è¯•å®Œæˆåæ¸…ç†æµ‹è¯•æ•°æ®
4. **æ–‡æ¡£æ›´æ–°**ï¼šæ·»åŠ æ–°æµ‹è¯•æ—¶æ›´æ–°æ­¤æ–‡æ¡£

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [APIä½¿ç”¨æŒ‡å—](../docs/new-webhook-api-guide.md)
- [éƒ¨ç½²æŒ‡å—](../DEPLOYMENT_GUIDE.md)
- [Dockeréƒ¨ç½²](../DOCKER_DEPLOY_README.md)
